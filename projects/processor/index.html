<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Out-of-order Processor | Gregory Payton </title> <meta name="author" content="Gregory Scott Payton"> <meta name="description" content="An out-of-order processor written in Verilog for the RISC-V ISA"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://gpayton787.github.io/projects/processor/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Gregory Payton </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Out-of-order Processor</h1> <p class="post-description">An out-of-order processor written in Verilog for the RISC-V ISA</p> </header> <article> <h1 id="risc-v-out-of-order-processor">RISC-V Out-of-Order Processor</h1> <p><strong>Date completed</strong>: 2024-12-14 <strong>Contributors</strong>: Gregory Payton &amp; Heran Yang</p> <h2 id="overview">Overview</h2> <p>In this project, we implemented an <strong>Out-of-Order Processor</strong> using <strong>Verilog</strong>, demonstrating an understanding of modern proccessor design principles that improve performance. The processor leverages out-of-order execution to optimize throughput while maintaining program correctness. This project, developed collaboratively me and my partner, Heran Yang, showcases our ability to work together in a team to design, simulate, and validate a complex digital system. By starting early, using iterative and test driven developement, and working extremely hard, we completed this impressive project over the span of six weeks during our fall quarter.</p> <h2 id="table-of-contents">Table of Contents</h2> <ul> <li><a href="#overview">Overview</a></li> <li><a href="#background-information">Background Information</a></li> <li><a href="#objective">Objective</a></li> <li><a href="#technologies-used">Technologies Used</a></li> <li><a href="#system-architecture">System Architecture</a></li> <li><a href="#implementation">Implementation</a></li> <li><a href="#references">References</a></li> </ul> <h2 id="background-information">Background Information</h2> <p>The “Iron Law” of processor performance states that:</p> <blockquote> <p>CPU Time = IC x CPI x CT where: IC = Instruction Count, CPI = Cycles Per Instruction, CT = Cycle Time</p> </blockquote> <p>Considering the CPU time of a simple processor (single-cycle and in-order), a few tricks can be used to decrease CPU time.</p> <p>We can use <strong>pipe-lining</strong> which splits the processor into different stages, allowing us to clock faster, and utilize our hardware more efficiently. This decreases our CT.</p> <p>We can use instruction-level <strong>parallelism</strong> by duplicating our hardware N times to run N instructions at a time. A pipelined processor that can issue/processor multiple instructions simultaneously is called <strong>Super Scalar</strong>. This increases IPC.</p> <p>This approach however is unable to make full use of it’s added hardware because of data dependencies between instructions. To get the most out of our super scalar we need <strong>out-order execution</strong>. Out-of-order execution allows instructions to be executed in any order, which is helpful for filling up the pipelines as long as independent instructions can be found. The trade-off for this speed is added complexity and hardware to address the problems that arise when things are done out of order.</p> <p><strong>RISC-V</strong> is an open source Instruction Set Architecture (ISA) that we’ll be using for our implementation.</p> <h2 id="objective">Objective</h2> <p>The main objective is to create an out-of-order processor capable of supporting the following RISC-V instructions: ADD, ADDI, LUI, ORI, XOR, SRAI, LB, LW, SB, SW.</p> <p>Specifications:</p> <ul> <li>32 bit instruction size</li> <li>Standard ALU instructions</li> <li>2-Issue processor</li> <li>1 fetch per CC</li> <li>Assume no stalling, except at the issue stage</li> </ul> <p>This can be broken down into many sub-objectives regarding the execution flow of the processor. Execution flow generally has around 7 pipeline stages:</p> <ol> <li>Fetch (inorder)</li> <li>Decode (inorder)</li> <li>Rename (inorder)</li> <li>Dispatch (inorder)</li> <li>Issue (out-of-order)</li> <li>Complete (out-of-order)</li> <li>Retire (inorder)</li> </ol> <p>These can be further broken down into the modules making up each stage. See below for more details. Modules are individually tested and then connected in a top-level module and tested again. The best path of development was completing the stages in order so that new modules could immediately be tested with the rest of the design. This drastically cut down on the time we spent doing verification and testing.</p> <h2 id="technologies-used">Technologies Used</h2> <ul> <li>Verilog</li> <li>EDA Playground</li> </ul> <p>We both have macs so we were unable to install a proper Verilog IDE like Vivado, but we made it work with EDA playground, an online IDE that works quite well.</p> <h2 id="system-architecture">System Architecture</h2> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/oopdesign.png" sizes="95vw"></source> <img src="/assets/img/oopdesign.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="wb_diagram" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Pictured above is the architecture level diagram of the processor. This provides a high level overview of how each sub-block interacts with one another. It mainly shows the datapath which is useful to visualize the life-cylce of an instruction. A lot more signals are needed for the design but for readability purposes, they are not shown in the diagram.</p> <h2 id="implementation">Implementation</h2> <p>Below are details on the modules that makes up the design.</p> <h3 id="fetch">Fetch</h3> <p>Submodules</p> <ul> <li>PC</li> <li>PC Adder</li> <li>Instruction Read Only Memory (ROM) (4KB)</li> </ul> <p><strong>Inputs: None Outputs: 12 bit PC, 32 bit instruction</strong></p> <p>The fetch module handles the storage and increment of the program counter. The program counter is used to index the Instruction ROM.</p> <h3 id="decode">Decode</h3> <p>Submodules</p> <ul> <li>Controller</li> <li>Immediate generator</li> <li>ALU controller</li> </ul> <p><strong>Inputs: 12 bit PC Outputs: 12 bit PC, 7 bit control signals, 32 bit immediate, 3 bit ALU operation signal</strong></p> <p>The Decode modules takes in the 32 bit instruction and generates the corresponding control signals and immediate for it.</p> <h3 id="free-pool">Free Pool</h3> <ul> <li>Contains a stack of unused physical registers</li> <li>Initialized with registers 63 (top) to 32</li> <li>Maximum depth of 32</li> </ul> <p>The Free Pool pops of a register for renaming when the instruction has a destination register (pop signal is 1). It pushes up to two freed physical registers when instructions are retired from the ROB (push1 &amp; push2 signals are 1). Popping happens on the positive edge of the clock and pushing happens on the negetaive edge.</p> <h3 id="ap-reg-file">A/P Reg File</h3> <ul> <li>Contains 32 entry Register Alias Table (RAT).</li> <li>RAT is initialized with 1 to 1 mapping, i.e. 0-&gt;0, 1-&gt;1, etc.</li> <li>64 Entry ready table for physical registers</li> <li>64 Entry, 32 bit memory for physical registers</li> </ul> <p>There is no actual architectural register file. Instead this register holds mappings from architectural to physcial register tags. The associated tags are then used to index the acutal physical registers. More physical than architectural registers is essential for renaming which gets rid of false dependecies.</p> <h3 id="reservation-station">Reservation Station</h3> <ul> <li>64 entries, 157 bits per entry</li> <li>Stores instruction data and relevant signals</li> <li>Can issue up to 3 instructions at a time</li> <li>Forwarding from ALUs updates register data and ready status</li> </ul> <p>During dispatch, the reservation station or unified issue queue reserves an entry for the instruction, assigning it an FU and an ROB number. At the start of each clock cycle, any instruction from the issue queue can be issued as long as it’s source registers and assigned FU is ready. The RS also gets written back to on the negative edge of the clock, updating any register data and ready signals sent back from the execution stage.</p> <h3 id="fu-table">FU Table</h3> <ul> <li>3, 1 bit entries</li> <li>Updates at the negative edge of the clock</li> <li>FU updates take priority over RS updates.</li> </ul> <p>The FU table stores the current execution status of each of the three functional units (ready or not ready). The FU outputs these signals to the RS so it knows which instructions it can issue. The RS and FUs update the FU table at the negedge of the clock. The RS updates not ready statuses when issuing, and the FUs update ready statuses when finishing an instruction. Thus, the FU updates will take priorty, meaning we’ll OR the updates together. A not ready (0) and a ready (1) result in the FU being ready.</p> <h3 id="alu">ALU</h3> <ul> <li>3 ALUs</li> <li>Support XOR, OR, AND, ADD, SHIFT_LEFT, SHIFT_RIGHT</li> <li>FU status gets written back to FU Table</li> <li>FU 3 is for memory operations (load &amp; store)</li> <li>FU 1 &amp; 2 are for all other operations</li> <li>Result 3 goes to the LSQ</li> <li>Result 1 &amp; 2 go to the Complete stage</li> </ul> <h3 id="reorder-buffer">Reorder Buffer</h3> <ul> <li>64, 58 bit entries</li> <li>Stores use bit, rd, old rd, pc, result, complete bit</li> </ul> <p>The ROB reserves an entry at the same time as the RS, with the RS using the corresponsding ROB entry number. Whenever an instruction is completed, it’s results are written to the ROB and it’s complete bit is set. Starting from the head of the ROB, instructions are retired in order as long as all other instructions before it are also complete. Upon retiring, the data is written back to the physical register files and forwarded to the reservation station since we capture register data as soon as an entry is reserved. We also push the old destination register back onto the free pool. We can retire up to two instructions at per cycle.</p> <h3 id="load-store-queue">Load Store Queue</h3> <ul> <li>Buffers load and store operations with PC as ID</li> <li>Also stores associated instruction information</li> <li>Reserve entries @(posedge clk)</li> <li>Addresses are received from FU #2</li> <li>Update Logic @(negedge clk) <ul> <li>If updating a load, update address and scan previous entries for forwarding from matching stores</li> <li>If a store, update address and data</li> </ul> </li> <li>Issuing Logic @(posedge clk) <ul> <li>If memory is not busy and hasn’t just finished <ul> <li>If a load check if it can bypass memory</li> <li>If not, send it to memory</li> <li>Else send store to memory</li> </ul> </li> <li>Otherwise we wait <ul> <li>While we wait check to see if an instruction finishes</li> </ul> </li> <li>If an instruction finishes put it on BUS2</li> </ul> </li> </ul> <h3 id="memory">Memory</h3> <ul> <li>Simulates latency using a counter and taking snapshots of initial signals</li> <li>Busy and Done flags <ul> <li>While Busy we wait</li> <li>When Done, LSQ handles result</li> </ul> </li> <li>Is_byte flag, comes from instruction information stored in LSQ</li> <li>If is_byte is set <ul> <li>If store, only wire least significant byte of data</li> <li>If a load, sign extend the retrieved byte</li> </ul> </li> <li>Otherwise store and load at word granularity</li> </ul> <h2 id="conclusion">Conclusion</h2> <p>This was one of the coolest and most enjoyable projects I’ve done at UCLA so far. Shout out to Professor Sehat for making this class and honors seminar a great experience. If it weren’t for him I wouldn’t like hardware as much as I do now. Also big thanks to my teammate for sticking it out with me, despite not even begin enrolled in the class.</p> <h2 id="references">References</h2> <ul> <li><a href="https://www.chipverify.com/tutorials/verilog" rel="external nofollow noopener" target="_blank">Verilog Tutorial</a></li> <li><a href="https://edaplayground.com/home" rel="external nofollow noopener" target="_blank">EDA Playground</a></li> </ul> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2026 Gregory Scott Payton. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script>let searchTheme=determineComputedTheme();const ninjaKeys=document.querySelector("ninja-keys");"dark"===searchTheme?ninjaKeys.classList.add("dark"):ninjaKeys.classList.remove("dark");const openSearchModal=()=>{const e=$("#navbarNav");e.hasClass("show")&&e.collapse("hide"),ninjaKeys.open()};</script> <script>const ninja=document.querySelector("ninja-keys");ninja.data=[{id:"nav-about",title:"about",section:"Navigation",handler:()=>{window.location.href="/"}},{id:"nav-blog",title:"blog",description:"",section:"Navigation",handler:()=>{window.location.href="/blog/"}},{id:"nav-projects",title:"projects",description:"",section:"Navigation",handler:()=>{window.location.href="/projects/"}},{id:"news-a-simple-inline-announcement",title:"A simple inline announcement.",description:"",section:"News"},{id:"news-a-long-announcement-with-details",title:"A long announcement with details",description:"",section:"News",handler:()=>{window.location.href="/news/announcement_2/"}},{id:"news-a-simple-inline-announcement-with-markdown-emoji-sparkles-smile",title:'A simple inline announcement with Markdown emoji! <img class="emoji" title=":sparkles:" alt=":sparkles:" src="https://github.githubassets.com/images/icons/emoji/unicode/2728.png" height="20" width="20"> <img class="emoji" title=":smile:" alt=":smile:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png" height="20" width="20">',description:"",section:"News"},{id:"projects-countryguessr",title:"CountryGUESSR",description:"Inspired by the famous geography guessing game GeoGUESSR, take your world knowledge to the next level with CountryGUESSR",section:"Projects",handler:()=>{window.location.href="/projects/countryguessr/"}},{id:"projects-brewin-interpreter",title:"Brewin Interpreter",description:"An interpreter written in Python for a brand new programming language called Brewin",section:"Projects",handler:()=>{window.location.href="/projects/interpreter/"}},{id:"projects-out-of-order-processor",title:"Out-of-order Processor",description:"An out-of-order processor written in Verilog for the RISC-V ISA",section:"Projects",handler:()=>{window.location.href="/projects/processor/"}},{id:"projects-single-cycle-processor-simulator",title:"Single-Cycle Processor Simulator",description:"A C++ program that simulates a single-cycle processor for the RISC-V32 ISA",section:"Projects",handler:()=>{window.location.href="/projects/singlecycle/"}},{id:"projects-c-web-server",title:"C++ Web Server",description:"A simple web server implementation capable of receiving Http requests, processing them, and returning Http Responses",section:"Projects",handler:()=>{window.location.href="/projects/webserver/"}},{id:"projects-whatsbruin",title:"WhatsBruin",description:"A full-stack web application that enables UCLA students to get the most out of their dining hall experience",section:"Projects",handler:()=>{window.location.href="/projects/whatsbruin/"}},{id:"socials-email",title:"Send email",section:"Socials",handler:()=>{window.open("mailto:%67%70%61%79%74%6F%6E%37%35%37@%67%6D%61%69%6C.%63%6F%6D","_blank")}},{id:"socials-github",title:"GitHub",section:"Socials",handler:()=>{window.open("https://github.com/gpayton787","_blank")}},{id:"socials-linkedin",title:"LinkedIn",section:"Socials",handler:()=>{window.open("https://www.linkedin.com/in/gregorypayton","_blank")}},{id:"socials-instagram",title:"Instagram",section:"Socials",handler:()=>{window.open("https://instagram.com/gpayton_","_blank")}},{id:"light-theme",title:"Change theme to light",description:"Change the theme of the site to Light",section:"Theme",handler:()=>{setThemeSetting("light")}},{id:"dark-theme",title:"Change theme to dark",description:"Change the theme of the site to Dark",section:"Theme",handler:()=>{setThemeSetting("dark")}},{id:"system-theme",title:"Use system default theme",description:"Change the theme of the site to System Default",section:"Theme",handler:()=>{setThemeSetting("system")}}];</script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>