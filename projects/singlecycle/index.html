<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Single-Cycle Processor Simulator | Gregory Payton </title> <meta name="author" content="Gregory Scott Payton"> <meta name="description" content="A C++ program that simulates a single-cycle processor for the RISC-V32 ISA"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://gpayton787.github.io/projects/singlecycle/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Gregory Payton </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Single-Cycle Processor Simulator</h1> <p class="post-description">A C++ program that simulates a single-cycle processor for the RISC-V32 ISA</p> </header> <article> <h2 id="table-of-contents">Table of Contents</h2> <ul> <li><a href="#overview">Overview</a></li> <li><a href="#background-information">Background Information</a></li> <li><a href="#goals">Goals</a></li> <li><a href="#implementation">Implementation</a></li> <li><a href="#results">Results</a></li> </ul> <h2 id="overview">Overview</h2> <p>This is the first project in the class ECE-M116 Computer Systems Architecture. In this project, we were tasked with designing and implementing a single-cycle processor for the RISCV-32 <a href="#background-information">ISA</a>. This process begins with a design of the data path &amp; controller, followed by the implementation of the design in C++.</p> <p><strong>Date completed</strong>: October 2024 <strong>Contributors</strong>: Gregory Payton</p> <h2 id="background-information">Background Information</h2> <p>This section serves to provide some necessary background knowledge to readers who are not familiar with the material.</p> <ul> <li>A <strong>processor</strong>, also known as a CPU, is a hardware unit that executes instructions for your computer. Every program that runs on your computer is eventually boiled down into a set of assembly instructions that the hardware understands. This set of instructions is called the <strong>Instruction Set Architecture (ISA)</strong>, and it serves as an interface between your computer’s software and hardware</li> <li>A processor’s job is simple: fetch and execute instructions and store their results. How it achieves this, however, is a different story. Processors vary in their implementation and, thus, their performance. In this project, we build a <strong>single cycle</strong> processor, meaning each instruction takes 1 complete clock cycle to run to completion. This is perhaps the simplest CPU design, which is 100% correct, but it’s just TOO slow. Modern processors are <strong>multi-cycle</strong>, meaning the CPU’s workflow is split into multiple stages, allowing us to increase the clock speed and better use the CPU’s hardware at each stage. However, techniques to increase the speed and efficiency of a processor result in added complexity and correctness issues that are difficult to address. Thus, we’ll stick with the single-cycle processor for now.</li> </ul> <h2 id="goals">Goals</h2> <p>The goals for this project are to design a datapath &amp; controller that supports the following instructions.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ADD, LUI, ORI, XOR, SRAI

LB, LW, SB, SW

BEQ, JAL
</code></pre></div></div> <p>The design should be based on the datapath &amp; controller we learned about in class, pictured below.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/defaultdatapath.png" sizes="95vw"></source> <img src="/assets/img/defaultdatapath.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="wb_diagram" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h2 id="implementation">Implementation</h2> <p>To begin, I compiled a table of the instructions and their opcodes (similar to an instruction ID) along with their corresponding control signals. These control signals will be manipulated throughout the datapath to ensure the correct execution of each instruction.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/singlecycletable.png" sizes="95vw"></source> <img src="/assets/img/singlecycletable.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="wb_diagram" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Each control signal serves a different purpose depending on the behavior of the instruction. For example, ALUSRC is a bit that is set to 0 if the soruce to the ALU should be a register or 1 if it should be an immediate. I then designed the data path. This was an incremental process, as I made many changes to the initial design as I progressed through the coding part.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/singlecycle.png" sizes="95vw"></source> <img src="/assets/img/singlecycle.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="wb_diagram" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> In the design above a few notable changes were made to the original data path. A byte signal was added to the controller for B-type instructions. Logic was added to support the JAL instruction. The ALUOP was extended to 3 bits to support more operation types. </div> <p>Implementing the design in C++ was straightforward in principle but tedious in practice. To illustrate, let’s take a look at some of the class definitions of the equivalent hardware components in the CPU.</p> <p>I defined many constants as strings to make them readable and make debugging easier.</p> <pre><code class="language-C">[label CPU.h]
//GLOBAL STUFF
const int INSTMEM_SIZE = 4096;
const int DMEM_SIZE = 4096*4;
//OPCODES
const string R_TYPE_OP = "0110011";
const string I_TYPE_OP = "0010011";
const string L_OP = "0000011";
const string S_OP = "0100011";
const string BEQ_OP = "1100011";
const string JAL_OP = "1101111";
const string LUI_OP = "0110111";
//FUNCT3s
const string F3_BYTE = "000";
const string F3_WORD = "010";
const string F3_SHIFT = "101";
...
</code></pre> <p>For each hardware component in the CPU a corresponding class or function was defined. For example here is the class definition of the CPU itself. It takes care of the program counter (PC) and fetches instructions. It also handles DRAM which is on chip-memory that is much slower than the register file.</p> <pre><code class="language-C">class CPU {

public:
    CPU();
    long readPC();
    void setPC(long next_pc);
    void incPC();
    void fetch(char* instMem); //Fetches a single instruction relative to PC
    Instruction get_inst();
    int read_mem(int index, bool MemRe, bool isByte);
    void write_mem(int index, int val, bool MemWrite, bool isByte);


private:
    char dmemory[DMEM_SIZE]; //data memory byte addressable in little endian fashion;
    long PC; //pc
    Instruction inst;
};
</code></pre> <p>Here is the definition of the register file. It allows you to read and write to the register file. Each register is 32 bits long.</p> <pre><code class="language-C">//WORKS WITH INTS
class Reg_file {
    public:
        Reg_file() {
            std::fill(std::begin(arr), std::end(arr), 0);
        }

        int get_reg(int rs);
        void set_reg(int rd, int val, bool reg_write);

    private:
        int arr[32];
};
</code></pre> <p>Here are some other definitions of components. The ALU is defined as a class and handles all computations. Other components are defined as functions. For example the MUX, immediate generator, and control units are all functions. This is mostly a matter of preference. If the inputs and outputs are simple and very combinational I opted to use a function. If there are many moving parts and return values I found it easier to define a class with each return value as a member variable.</p> <pre><code class="language-C">class ALU {
    public:
        void compute(int arg1, int arg2, bitset&lt;3&gt; alu_op);
        int get_result(){ return result; };
        bool get_zero_flag(){ return zero; };

    private:
        bool zero;
        int result;
};

//Returns a 6 bit value where msb to lsb is REGWRITE | ALUSRC | BRANCH | MEMRE | MEMWR | MEMREG
bitset&lt;7&gt; control(bitset&lt;7&gt; opcode, bitset&lt;3&gt; funct3);

bitset&lt;3&gt; alu_control(bitset&lt;7&gt; opcode, bitset&lt;3&gt; funct3);

bitset&lt;64&gt; imm_generator(Instruction Instr, bitset&lt;7&gt; op_code, bitset&lt;3&gt; funct3);

long two_bit_mux(bool sig, long arg0, long arg1);
</code></pre> <p>Overall the implementation followed pretty easily from the design. The hardest part of the project was handling all the bit operations correctly and testing instructions to ensure their correctness. Actually about half of the project was just writing test cases in assembly code and then manually converting them to machine code in the input format required for the simulator.</p> <h2 id="results">Results</h2> <p>After a few days and more time debugging than actually coding, I finished the project and received a 100/100, passing all tests on Gradescope. Overall, the project was very enjoyable and informative. Building a simulator from scratch ensures you really know what’s going on at each step in the CPU. If you liked this project, make sure you stay tuned for the Out-of-Order processor, which is going to be blazingly fast compared to this one. However, while executing instructions out-of-order may increase speed and efficiency, it also raises new problems and complexity that will need to be addressed… next time.</p> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2026 Gregory Scott Payton. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script>let searchTheme=determineComputedTheme();const ninjaKeys=document.querySelector("ninja-keys");"dark"===searchTheme?ninjaKeys.classList.add("dark"):ninjaKeys.classList.remove("dark");const openSearchModal=()=>{const e=$("#navbarNav");e.hasClass("show")&&e.collapse("hide"),ninjaKeys.open()};</script> <script>const ninja=document.querySelector("ninja-keys");ninja.data=[{id:"nav-about",title:"about",section:"Navigation",handler:()=>{window.location.href="/"}},{id:"nav-blog",title:"blog",description:"",section:"Navigation",handler:()=>{window.location.href="/blog/"}},{id:"nav-projects",title:"projects",description:"",section:"Navigation",handler:()=>{window.location.href="/projects/"}},{id:"news-a-simple-inline-announcement",title:"A simple inline announcement.",description:"",section:"News"},{id:"news-a-long-announcement-with-details",title:"A long announcement with details",description:"",section:"News",handler:()=>{window.location.href="/news/announcement_2/"}},{id:"news-a-simple-inline-announcement-with-markdown-emoji-sparkles-smile",title:'A simple inline announcement with Markdown emoji! <img class="emoji" title=":sparkles:" alt=":sparkles:" src="https://github.githubassets.com/images/icons/emoji/unicode/2728.png" height="20" width="20"> <img class="emoji" title=":smile:" alt=":smile:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png" height="20" width="20">',description:"",section:"News"},{id:"projects-countryguessr",title:"CountryGUESSR",description:"Inspired by the famous geography guessing game GeoGUESSR, take your world knowledge to the next level with CountryGUESSR",section:"Projects",handler:()=>{window.location.href="/projects/countryguessr/"}},{id:"projects-brewin-interpreter",title:"Brewin Interpreter",description:"An interpreter written in Python for a brand new programming language called Brewin",section:"Projects",handler:()=>{window.location.href="/projects/interpreter/"}},{id:"projects-out-of-order-processor",title:"Out-of-order Processor",description:"An out-of-order processor written in Verilog for the RISC-V ISA",section:"Projects",handler:()=>{window.location.href="/projects/processor/"}},{id:"projects-single-cycle-processor-simulator",title:"Single-Cycle Processor Simulator",description:"A C++ program that simulates a single-cycle processor for the RISC-V32 ISA",section:"Projects",handler:()=>{window.location.href="/projects/singlecycle/"}},{id:"projects-c-web-server",title:"C++ Web Server",description:"A simple web server implementation capable of receiving Http requests, processing them, and returning Http Responses",section:"Projects",handler:()=>{window.location.href="/projects/webserver/"}},{id:"projects-whatsbruin",title:"WhatsBruin",description:"A full-stack web application that enables UCLA students to get the most out of their dining hall experience",section:"Projects",handler:()=>{window.location.href="/projects/whatsbruin/"}},{id:"socials-email",title:"Send email",section:"Socials",handler:()=>{window.open("mailto:%67%70%61%79%74%6F%6E%37%35%37@%67%6D%61%69%6C.%63%6F%6D","_blank")}},{id:"socials-github",title:"GitHub",section:"Socials",handler:()=>{window.open("https://github.com/gpayton787","_blank")}},{id:"socials-linkedin",title:"LinkedIn",section:"Socials",handler:()=>{window.open("https://www.linkedin.com/in/gregorypayton","_blank")}},{id:"socials-instagram",title:"Instagram",section:"Socials",handler:()=>{window.open("https://instagram.com/gpayton_","_blank")}},{id:"light-theme",title:"Change theme to light",description:"Change the theme of the site to Light",section:"Theme",handler:()=>{setThemeSetting("light")}},{id:"dark-theme",title:"Change theme to dark",description:"Change the theme of the site to Dark",section:"Theme",handler:()=>{setThemeSetting("dark")}},{id:"system-theme",title:"Use system default theme",description:"Change the theme of the site to System Default",section:"Theme",handler:()=>{setThemeSetting("system")}}];</script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>